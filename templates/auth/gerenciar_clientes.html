<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Clientes ‚Ä¢ MAGDA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/clientes-minimal.css">
    <link rel="icon" href="/static/images/simple_magda_logo.png" type="image/png">
</head>
<body>
    <!-- Navbar -->
    {% include 'layouts/navbar.html' %}

    <!-- Espa√ßo fixo ap√≥s navbar -->
    <div class="navbar-spacing"></div>

    <!-- Conte√∫do Principal -->
    <main class="clientes-minimal-container">
        <!-- Cabe√ßalho Centralizado -->
        <div class="clientes-minimal-header">
            <div class="minimal-header-content centered">
                <h1 class="minimal-title">
                    üë• Gerenciar Clientes
                </h1>
                <p class="minimal-subtitle">Gerencie todos os clientes cadastrados no sistema</p>
            </div>
            
            <!-- Busca Centralizada -->
            <div class="minimal-search-container centered">
                <div class="minimal-search-box">
                    <input type="text" id="minimal-search" placeholder="Buscar cliente por nome, email ou CPF...">
                    <div class="search-focus-line"></div>
                </div>
            </div>
        </div>

        <!-- Filtros Centralizados -->
        <div class="minimal-filters centered">
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">
                    <span>Todos</span>
                    <span class="filter-count">{{ clientes|length }}</span>
                </button>
                <button class="filter-btn" data-filter="active">
                    <span>Ativos</span>
                    <span class="filter-count" id="count-active">
                        {% set ativos = clientes|selectattr('ativo', 'equalto', True)|list %}
                        {{ ativos|length }}
                    </span>
                </button>
                <button class="filter-btn" data-filter="inactive">
                    <span>Inativos</span>
                    <span class="filter-count" id="count-inactive">
                        {% set inativos = clientes|selectattr('ativo', 'equalto', False)|list %}
                        {{ inativos|length }}
                    </span>
                </button>
            </div>
        </div>

        <!-- Lista de Clientes -->
        <div class="clientes-minimal-lista" id="clientes-lista">
            {% for cliente in clientes %}
            <div class="cliente-minimal-card" data-status="{{ 'active' if cliente.ativo else 'inactive' }}">
                <div class="card-minimal-content">
                    <!-- Header do Card -->
                    <div class="card-minimal-header">
                        <div class="header-left">
                            <h3 class="cliente-nome">{{ cliente.nome_completo }}</h3>
                            <div class="cliente-meta">
                                <span class="meta-item">
                                    <i class="far fa-id-card"></i>
                                    ID: {{ cliente.id }}
                                </span>
                                <span class="meta-item">
                                    <i class="far fa-calendar"></i>
                                    {% if cliente.data_cadastro %}
                                        {{ cliente.data_cadastro.strftime('%d/%m/%Y') if cliente.data_cadastro is string else cliente.data_cadastro }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <div class="header-right">
                            <div class="status-indicator {{ 'active' if cliente.ativo else 'inactive' }}">
                                <span class="status-dot"></span>
                                {{ 'Ativo' if cliente.ativo else 'Inativo' }}
                            </div>
                        </div>
                    </div>

                    <!-- Detalhes do Cliente -->
                    <div class="card-minimal-details">
                        <div class="detail-row">
                            <div class="detail-item">
                                <div class="detail-label">
                                    <i class="far fa-envelope"></i>
                                    Email
                                </div>
                                <div class="detail-value">{{ cliente.email }}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">
                                    <i class="fas fa-phone"></i>
                                    Telefone
                                </div>
                                <div class="detail-value">{{ cliente.telefone or 'N√£o informado' }}</div>
                            </div>
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-item">
                                <div class="detail-label">
                                    <i class="fas fa-fingerprint"></i>
                                    CPF
                                </div>
                                <div class="detail-value">{{ cliente.cpf or 'N√£o informado' }}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">
                                    <i class="fas fa-birthday-cake"></i>
                                    Data Nascimento
                                </div>
                                <div class="detail-value">
                                    {% if cliente.nascimento %}
                                        {{ cliente.nascimento.strftime('%d/%m/%Y') if cliente.nascimento is string else cliente.nascimento }}
                                    {% else %}
                                        N√£o informado
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-item">
                                <div class="detail-label">
                                    <i class="far fa-clock"></i>
                                    Data de Cria√ß√£o da Conta
                                </div>
                                <div class="detail-value">
                                    {% if cliente.data_cadastro %}
                                        {% if cliente.data_cadastro is string %}
                                            {{ cliente.data_cadastro }}
                                        {% else %}
                                            {{ cliente.data_cadastro.strftime('%d/%m/%Y %H:%M') }}
                                        {% endif %}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">
                                    <i class="fas fa-user-tag"></i>
                                    Tipo de Conta
                                </div>
                                <div class="detail-value">
                                    {{ 'Administrador' if cliente.is_admin else 'Cliente' }}
                                </div>
                            </div> 
                        </div>
                    </div>

                    <!-- A√ß√µes -->
                    <div class="card-minimal-actions">
                        <div class="action-buttons">
                            <a href="/editar_cliente/{{ cliente.id }}" class="action-btn edit-btn">
                                <i class="fas fa-edit"></i>
                                <span>Editar</span>
                            </a>
                            
                            {% if cliente.ativo %}
                            <a href="/admin/desativar_usuario/{{ cliente.id }}" 
                               class="action-btn deactivate-btn"
                               onclick="return confirmDesativar('{{ cliente.nome_completo }}')">
                                <i class="fas fa-user-slash"></i>
                                <span>Desativar</span>
                            </a>
                            {% else %}
                            <a href="/admin/ativar_usuario/{{ cliente.id }}" 
                               class="action-btn activate-btn"
                               onclick="return confirmAtivar('{{ cliente.nome_completo }}')">
                                <i class="fas fa-user-check"></i>
                                <span>Ativar</span>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="card-minimal-border"></div>
            </div>
            {% endfor %}
            
            {% if not clientes %}
            <div class="empty-state centered">
                <div class="empty-icon">
                    <i class="fas fa-users-slash"></i>
                </div>
                <h3>Nenhum cliente encontrado</h3>
                <p>N√£o h√° clientes cadastrados no momento.</p>
            </div>
            {% endif %}
        </div>
    </main>

    <!-- Footer com Espa√ßamento -->
    <div class="footer-spacing"></div>
    {% include 'layouts/footer.html' %}

    <script>
        // Sistema de busca
        const searchInput = document.getElementById('minimal-search');
        const clientCards = document.querySelectorAll('.cliente-minimal-card');
        
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            let visibleCount = 0;
            
            clientCards.forEach(card => {
                const name = card.querySelector('.cliente-nome').textContent.toLowerCase();
                const email = card.querySelectorAll('.detail-value')[0]?.textContent.toLowerCase() || '';
                const cpf = card.querySelectorAll('.detail-value')[2]?.textContent.toLowerCase() || '';
                
                const matches = name.includes(searchTerm) || 
                               email.includes(searchTerm) || 
                               cpf.includes(searchTerm);
                
                if (matches) {
                    card.style.display = 'block';
                    visibleCount++;
                    
                    // Efeito de destaque
                    if (searchTerm) {
                        card.classList.add('highlight');
                        setTimeout(() => card.classList.remove('highlight'), 1000);
                    }
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Atualizar contador "Todos"
            const todosBtn = document.querySelector('.filter-btn[data-filter="all"]');
            if (todosBtn) {
                todosBtn.querySelector('.filter-count').textContent = visibleCount;
            }
        });
        
        // Sistema de filtros
        const filterButtons = document.querySelectorAll('.filter-btn');
        
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active de todos
                filterButtons.forEach(btn => btn.classList.remove('active'));
                // Adiciona ao clicado
                this.classList.add('active');
                
                const filter = this.dataset.filter;
                const cards = document.querySelectorAll('.cliente-minimal-card');
                let visibleCount = 0;
                
                cards.forEach(card => {
                    if (filter === 'all') {
                        // Verifica se n√£o est√° filtrado pela busca
                        const currentSearch = searchInput.value.toLowerCase().trim();
                        if (currentSearch === '') {
                            card.style.display = 'block';
                            visibleCount++;
                        } else {
                            // Aplica ambos filtros: busca + status
                            const name = card.querySelector('.cliente-nome').textContent.toLowerCase();
                            const email = card.querySelectorAll('.detail-value')[0]?.textContent.toLowerCase() || '';
                            const cpf = card.querySelectorAll('.detail-value')[2]?.textContent.toLowerCase() || '';
                            
                            const matchesSearch = name.includes(currentSearch) || 
                                                 email.includes(currentSearch) || 
                                                 cpf.includes(currentSearch);
                            
                            if (matchesSearch) {
                                card.style.display = 'block';
                                visibleCount++;
                            } else {
                                card.style.display = 'none';
                            }
                        }
                    } else {
                        const status = card.dataset.status;
                        // Verifica busca + status
                        const currentSearch = searchInput.value.toLowerCase().trim();
                        const name = card.querySelector('.cliente-nome').textContent.toLowerCase();
                        const email = card.querySelectorAll('.detail-value')[0]?.textContent.toLowerCase() || '';
                        const cpf = card.querySelectorAll('.detail-value')[2]?.textContent.toLowerCase() || '';
                        
                        const matchesSearch = currentSearch === '' || 
                                            name.includes(currentSearch) || 
                                            email.includes(currentSearch) || 
                                            cpf.includes(currentSearch);
                        
                        if (status === filter && matchesSearch) {
                            card.style.display = 'block';
                            visibleCount++;
                        } else {
                            card.style.display = 'none';
                        }
                    }
                });
                
                // Atualizar contador do bot√£o ativo
                this.querySelector('.filter-count').textContent = visibleCount;
            });
        });
        
        // Efeito de hover nos cards
        clientCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
        
        // Efeito de foco na busca
        searchInput.addEventListener('focus', function() {
            this.parentElement.classList.add('focused');
        });
        
        searchInput.addEventListener('blur', function() {
            this.parentElement.classList.remove('focused');
        });
        
        // Fun√ß√µes de confirma√ß√£o
        function confirmDesativar(nome) {
            return confirm(`Tem certeza que deseja desativar o cliente "${nome}"?\n\nO cliente n√£o poder√° fazer login ap√≥s esta a√ß√£o.`);
        }
        
        function confirmAtivar(nome) {
            return confirm(`Tem certeza que deseja ativar o cliente "${nome}"?\n\nO cliente poder√° fazer login normalmente ap√≥s esta a√ß√£o.`);
        }
        
        // Atualizar contadores quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', function() {
            const activeCount = document.querySelectorAll('.cliente-minimal-card[data-status="active"]').length;
            const inactiveCount = document.querySelectorAll('.cliente-minimal-card[data-status="inactive"]').length;
            
            // Atualizar contadores nos bot√µes de filtro
            const activeBtn = document.querySelector('.filter-btn[data-filter="active"]');
            const inactiveBtn = document.querySelector('.filter-btn[data-filter="inactive"]');
            
            if (activeBtn) {
                activeBtn.querySelector('.filter-count').textContent = activeCount;
            }
            if (inactiveBtn) {
                inactiveBtn.querySelector('.filter-count').textContent = inactiveCount;
            }
        });
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    
</body>
</html>